{- Tests for case subtyping -}
module Main where

  -- External choice can offer more branches
  external : &{term : 1, product : 1 * 1}
  `c <- external = case `c of
    term -> close `c
    product -> do
      send `c (`d <- close `d)
      close `c
    unused -> close `c
    nonsense -> do
      `d <- recv `c  -- Note that this is unused
      close `c


  -- Internal choice on the left can handle more branches
  internal : +{term : 1, product : 1 * 1} -o 1
  `c <- internal = do
    `d <- recv `c
    case `d of
      term -> do wait `d; close `c
      product -> do
        `e <- recv `d
        wait `d
        wait `e
        close `c
      impossible -> close `c -- Note that `d is still open

